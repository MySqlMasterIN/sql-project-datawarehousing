/*
=============================================
Exploratory Data Analysis (EDA)
=============================================
/*

--------------------------------
1. Data Exploration
--------------------------------
a. To Explore all objects in the database- 
   By using the following script we can have information about the database name, schema_name, tabe_name and table_type.
   
   select * 
     from INFORMATION_SCHEMA.tables;

b. To Explore all columns in database-
   By using the following script we can have information about all the column available in database like database_name, schema_name,          table_name to which the column belong too. Also give information about the column data_type, character_maximum _lenght, default_value      etc.
    
   select * 
     from INFORMATION_SCHEMA.columns;

--------------------------------
2. Dimension Exploration
--------------------------------
Dimension exploration means examining data across different descriptive dimensions (country, category, subcategory) to see how the data can be grouped or segmented to further uncover patterns or trends for analysis.

>> Example --

   1. Explore all countries our customer comes from?

      select 
        distinct(country)
      from gold.dim_customers;

  2. Explore all the available product category

     select 
       distinct(category)
     from gold.dim_products;

--------------------------------
3. Date Exploration
--------------------------------
Date exploration examines how metrics and patterns change across time dimensions (daily, monthly, yearly trends, seasonality) to identify temporal relationships and business cycles in data analysis.

>> Example --

   1. Find the first and the last order date.

   select 
     min(order_date) as first_order_date,
     max(order_date) as last_order_date
   from gold.fact_sales;

   2. How many years of sales data is available

   select 
     DATEDIFF(year, min(order_date), max(order_date)) as order_range_year
   from gold.fact_sales;

   3. Find the youngest and the oldest customer

   select 
     datediff(year, min(birthdate), getdate()) as oldest_customer,
     datediff(year, max(birthdate), getdate()) as youngest_customer
   from gold.dim_customers;

--------------------------------
4. Measure Exploration
--------------------------------
Measure exploration examines numeric metrics (sales, revenue, counts) to understand their distribution, ranges, outliers, and trends across dimensions for deeper insights.

>> Example --

   1. Find the total sales

   select 
     sum(sales)
   from gold.fact_sales;

   2. Find total quantity sold

   select 
     sum(sales)
   from gold.fact_sales;

   3. Find the average selling price 

   select 
     avg(cost) as selling_price
   from gold.dim_products;

   4. Find the total numbers of orders

   select 
     count(distinct(order_number)) as total_orders
   from gold.fact_sales;

   5. Find the total number of products

   select 
     count(*)
   from gold.dim_products;

   6. Find the total number of customers

   select 
     count(*)
   from gold.dim_customers;

   7. Find the numnber of customers that placed the order.

   SELECT  
     count(distinct(customer_key))
   from gold.fact_sales;

   8. Bonus: creating a report containing all the measures for stake holders

   SELECT  
     'Total sales' as measure, sum(sales) as 'Measure value' from gold.fact_sales
   UNION ALL

   SELECT
    'Total quantity' as measure, sum(quantity) as'Measure value' from gold.fact_sales
   UNION ALL

   SELECT
     'Average selling price' as measure, avg(cost) as'Measure value' from gold.dim_products
    UNION ALL

   SELECT 
     'Total number orders' as measure, count(distinct(order_number)) as 'Measure value' from gold.fact_sales
    UNION ALL

   SELECT
     'Total Products' as measure, count(*) as 'Measure value' from gold.dim_products
   UNION ALL

   SELECT
     'Total Customers' as measure, count(*) as 'Measure value' from gold.dim_customers
   UNION ALL

   SELECT 
    'Customer placed order' as measure, count(distinct(customer_key)) from gold.fact_sales

--------------------------------
5. Magnitude Exploration
--------------------------------
Compare the measure values by categories and help us to know the importance of each category

>> Example --

   1. Find the total customers by country

        select 
          country, count(customer_key) as total_customers
        from gold.dim_customers
        group by country;

   2. Find total customers by gender

        select 
          gender, count(customer_key) as total_customers
        from gold.dim_customers
        group by gender;

   3. Find total products by category

        select 
          category,
          count(product_key) as total_products
        from gold.dim_products 
        group by category;

   4. What is the average cost in each category

        select 
          category,
          avg(cost) as avg_cost
        from gold.dim_products 
        group by category;

   5. what is the total revenue generated for each category

        SELECT  
          category,
          sum(sales) as revenue
        from gold.fact_sales
        left join gold.dim_products on gold.fact_sales.product_key = gold.dim_products.product_key
        group by category;

   6. Find the total revenue generated by each customer

        SELECT  
          firstname,
          lastname,
          sum(sales) as revenue
        from gold.fact_sales
        left join gold.dim_customers on gold.fact_sales.customer_key = gold.dim_customers.customer_key
        group by firstname, lastname;

   7. What is the distribution of sold items across each country

        SELECT  
          country,
          sum(quantity) as total_quantity_sold
        from gold.fact_sales
        left join gold.dim_customers on gold.fact_sales.customer_key = gold.dim_customers.customer_key
        group by country;

--------------------------------
5. Ranking Exploration
--------------------------------
Ranking exploration is to order the value of dimensions by measures. This analysis is done to find top or bottom performers.

>> Example --

   1. Which 5 products generate a highest revenue.

        SELECT  top 5
          product_name,
          sum(sales) as total_sale
        from gold.fact_sales
        left join gold.dim_products on gold.fact_sales.product_key = gold.dim_products.product_key
        group by product_name
        order by total_sale desc;

    ------------------------ solving same using window function ------------------------

        SELECT
          product_name,
          sum(sales) as total_sales,
          ROW_NUMBER() over(order by sum(sales)desc) as ranking
        from gold.fact_sales
        left join gold.dim_products on gold.fact_sales.product_key = gold.dim_products.product_key
        group by product_name

   2. What are the 5 worst selling product by revenue


        SELECT  top 5
          product_name,
          sum(sales) as total_sale
        from gold.fact_sales
        left join gold.dim_products on gold.fact_sales.product_key = gold.dim_products.product_key
        group by product_name
        order by total_sale;

   3. Find the top 10 customers generating highest revenue

        select top 10
          firstname,
          lastname,
          sum(sales) as totalsales
        from gold.fact_sales
        left join gold.dim_customers on gold.fact_sales.customer_key = gold.dim_customers.customer_key
        group by firstname, lastname
        order by totalsales desc;

   4. Find bottom 3 customers with fewer order placed

        select top 3
          gold.fact_sales.customer_key,
          firstname,
          lastname,
          count(distinct(order_number)) as total_orders
        from gold.fact_sales
        left join gold.dim_customers on gold.fact_sales.customer_key = gold.dim_customers.customer_key
        group by gold.fact_sales.customer_key, firstname, lastname
        order by total_orders;




